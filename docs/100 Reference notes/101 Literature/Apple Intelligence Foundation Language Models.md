---
authors:
  - "[[Tom Gunter|Tom Gunter]]"
  - "[[Zirui Wang|Zirui Wang]]"
  - "[[Chong Wang|Chong Wang]]"
  - "[[Ruoming Pang|Ruoming Pang]]"
  - "[[Andy Narayanan|Andy Narayanan]]"
  - "[[Aonan Zhang|Aonan Zhang]]"
  - "[[Bowen Zhang|Bowen Zhang]]"
  - "[[Chen Chen|Chen Chen]]"
  - "[[Chung-Cheng Chiu|Chung-Cheng Chiu]]"
  - "[[David Qiu|David Qiu]]"
  - "[[Deepak Gopinath|Deepak Gopinath]]"
  - "[[Dian Ang Yap|Dian Ang Yap]]"
  - "[[Dong Yin|Dong Yin]]"
  - "[[Feng Nan|Feng Nan]]"
  - "[[Floris Weers|Floris Weers]]"
  - "[[Guoli Yin|Guoli Yin]]"
  - "[[Haoshuo Huang|Haoshuo Huang]]"
  - "[[Jianyu Wang|Jianyu Wang]]"
  - "[[Jiarui Lu|Jiarui Lu]]"
  - "[[John Peebles|John Peebles]]"
  - "[[Ke Ye|Ke Ye]]"
  - "[[Mark Lee|Mark Lee]]"
  - "[[Nan Du|Nan Du]]"
  - "[[Qibin Chen|Qibin Chen]]"
  - "[[Quentin Keunebroek|Quentin Keunebroek]]"
  - "[[Sam Wiseman|Sam Wiseman]]"
  - "[[Syd Evans|Syd Evans]]"
  - "[[Tao Lei|Tao Lei]]"
  - "[[Vivek Rathod|Vivek Rathod]]"
  - "[[Xiang Kong|Xiang Kong]]"
  - "[[Xianzhi Du|Xianzhi Du]]"
  - "[[Yanghao Li|Yanghao Li]]"
  - "[[Yongqiang Wang|Yongqiang Wang]]"
  - "[[Yuan Gao|Yuan Gao]]"
  - "[[Zaid Ahmed|Zaid Ahmed]]"
  - "[[Zhaoyang Xu|Zhaoyang Xu]]"
  - "[[Zhiyun Lu|Zhiyun Lu]]"
  - "[[Al Rashid|Al Rashid]]"
  - "[[Albin Madappally Jose|Albin Madappally Jose]]"
  - "[[Alec Doane|Alec Doane]]"
  - "[[Alfredo Bencomo|Alfredo Bencomo]]"
  - "[[Allison Vanderby|Allison Vanderby]]"
  - "[[Andrew Hansen|Andrew Hansen]]"
  - "[[Ankur Jain|Ankur Jain]]"
  - "[[Anupama Mann Anupama|Anupama Mann Anupama]]"
  - "[[Areeba Kamal|Areeba Kamal]]"
  - "[[Bugu Wu|Bugu Wu]]"
  - "[[Carolina Brum|Carolina Brum]]"
  - "[[Charlie Maalouf|Charlie Maalouf]]"
  - "[[Chinguun Erdenebileg|Chinguun Erdenebileg]]"
  - "[[Chris Dulhanty|Chris Dulhanty]]"
  - "[[Dominik Moritz|Dominik Moritz]]"
  - "[[Doug Kang|Doug Kang]]"
  - "[[Eduardo Jimenez|Eduardo Jimenez]]"
  - "[[Evan Ladd|Evan Ladd]]"
  - "[[Fangping Shi|Fangping Shi]]"
  - "[[Felix Bai|Felix Bai]]"
  - "[[Frank Chu|Frank Chu]]"
  - "[[Fred Hohman|Fred Hohman]]"
  - "[[Hadas Kotek|Hadas Kotek]]"
  - "[[Hannah Gillis Coleman|Hannah Gillis Coleman]]"
  - "[[Jane Li|Jane Li]]"
  - "[[Jeffrey Bigham|Jeffrey Bigham]]"
  - "[[Jeffery Cao|Jeffery Cao]]"
  - "[[Jeff Lai|Jeff Lai]]"
  - "[[Jessica Cheung|Jessica Cheung]]"
  - "[[Jiulong Shan|Jiulong Shan]]"
  - "[[Joe Zhou|Joe Zhou]]"
  - "[[John Li|John Li]]"
  - "[[Jun Qin|Jun Qin]]"
  - "[[Karanjeet Singh|Karanjeet Singh]]"
  - "[[Karla Vega|Karla Vega]]"
  - "[[Kelvin Zou|Kelvin Zou]]"
  - "[[Laura Heckman|Laura Heckman]]"
  - "[[Lauren Gardiner|Lauren Gardiner]]"
  - "[[Margit Bowler|Margit Bowler]]"
  - "[[Maria Cordell|Maria Cordell]]"
  - "[[Meng Cao|Meng Cao]]"
  - "[[Nicole Hay|Nicole Hay]]"
  - "[[Nilesh Shahdadpuri|Nilesh Shahdadpuri]]"
  - "[[Otto Godwin|Otto Godwin]]"
  - "[[Pranay Dighe|Pranay Dighe]]"
  - "[[Pushyami Rachapudi|Pushyami Rachapudi]]"
  - "[[Ramsey Tantawi|Ramsey Tantawi]]"
  - "[[Roman Frigg|Roman Frigg]]"
  - "[[Sam Davarnia|Sam Davarnia]]"
  - "[[Sanskruti Shah|Sanskruti Shah]]"
  - "[[Saptarshi Guha|Saptarshi Guha]]"
  - "[[Sasha Sirovica|Sasha Sirovica]]"
  - "[[Shen Ma|Shen Ma]]"
  - "[[Shuang Ma|Shuang Ma]]"
  - "[[Simon Wang|Simon Wang]]"
  - "[[Sulgi Kim|Sulgi Kim]]"
  - "[[Suma Jayaram|Suma Jayaram]]"
  - "[[Vaishaal Shankar|Vaishaal Shankar]]"
  - "[[Varsha Paidi|Varsha Paidi]]"
  - "[[Vivek Kumar|Vivek Kumar]]"
  - "[[Xin Wang|Xin Wang]]"
  - "[[Xin Zheng|Xin Zheng]]"
  - "[[Walker Cheng |Walker Cheng ]]"
  - "[[Yael Shrager|Yael Shrager]]"
  - "[[Yang Ye|Yang Ye]]"
  - "[[Yasu Tanaka|Yasu Tanaka]]"
  - "[[Yihao Guo|Yihao Guo]]"
  - "[[Yunsong Meng|Yunsong Meng]]"
  - "[[Zhao Tang Luo|Zhao Tang Luo]]"
  - "[[Zhi Ouyang|Zhi Ouyang]]"
  - "[[Alp Aygar|Alp Aygar]]"
  - "[[Alvin Wan|Alvin Wan]]"
  - "[[Andrew Walkingshaw|Andrew Walkingshaw]]"
  - "[[Andy Narayanan|Andy Narayanan]]"
  - "[[Antonie Lin|Antonie Lin]]"
  - "[[Arsalan Farooq|Arsalan Farooq]]"
  - "[[Brent Ramerth|Brent Ramerth]]"
  - "[[Colorado Reed|Colorado Reed]]"
  - "[[Chris Bartels|Chris Bartels]]"
  - "[[Chris Chaney|Chris Chaney]]"
  - "[[David Riazati|David Riazati]]"
  - "[[Eric Liang Yang|Eric Liang Yang]]"
  - "[[Erin Feldman|Erin Feldman]]"
  - "[[Gabriel Hochstrasser|Gabriel Hochstrasser]]"
  - "[[Guillaume Seguin|Guillaume Seguin]]"
  - "[[Irina Belousova|Irina Belousova]]"
  - "[[Joris Pelemans|Joris Pelemans]]"
  - "[[Karen Yang|Karen Yang]]"
  - "[[Keivan Alizadeh Vahid|Keivan Alizadeh Vahid]]"
  - "[[Liangliang Cao|Liangliang Cao]]"
  - "[[Mahyar Najibi|Mahyar Najibi]]"
  - "[[Marco Zuliani|Marco Zuliani]]"
  - "[[Max Horton|Max Horton]]"
  - "[[Minsik Cho|Minsik Cho]]"
  - "[[Nikhil Bhendawade|Nikhil Bhendawade]]"
  - "[[Patrick Dong|Patrick Dong]]"
  - "[[Piotr Maj|Piotr Maj]]"
  - "[[Pulkit Agrawal|Pulkit Agrawal]]"
  - "[[Qi Shan|Qi Shan]]"
  - "[[Qichen Fu|Qichen Fu]]"
  - "[[Regan Poston|Regan Poston]]"
  - "[[Sam Xu|Sam Xu]]"
  - "[[Shuangning Liu|Shuangning Liu]]"
  - "[[Sushma Rao|Sushma Rao]]"
  - "[[Tashweena Heeramun|Tashweena Heeramun]]"
  - "[[Thomas Merth|Thomas Merth]]"
  - "[[Uday Rayala|Uday Rayala]]"
  - "[[Victor Cui|Victor Cui]]"
  - "[[Vivek Rangarajan Sridhar|Vivek Rangarajan Sridhar]]"
  - "[[Wencong Zhang|Wencong Zhang]]"
  - "[[Wenqi Zhang|Wenqi Zhang]]"
  - "[[Wentao Wu|Wentao Wu]]"
  - "[[Xingyu Zhou|Xingyu Zhou]]"
  - "[[Xinwen Liu|Xinwen Liu]]"
  - "[[Yang Zhao|Yang Zhao]]"
  - "[[Yin Xia|Yin Xia]]"
  - "[[Zhile Ren|Zhile Ren]]"
  - "[[Zhongzheng Ren|Zhongzheng Ren]]"
year: 2024
tags:
  - paper
  - efficient_dl
url: https://arxiv.org/abs/2407.21075
share: true
---
> [!tldr] Abstract
> We present foundation language models developed to power Apple Intelligence features, including a ~3 billion parameter model designed to run efficiently on devices and a large server-based language model designed for Private Cloud Compute. These models are designed to perform a wide range of tasks efficiently, accurately, and responsibly. This report describes the model architecture, the data used to train the model, the training process, how the models are optimized for inference, and the evaluation results. We highlight our focus on Responsible AI and how the principles are applied throughout the model development.

## Notes

> “A shared input/output embedding matrix [Press and Wolf, 2016] to reduce memory usage for parameters.” (Gunter et al., 2024, p. 2)

This reminds me of the [[Residual stream|Residual stream]] interpretation of transformers.

> “The model is compressed and quantized, on average under 4-bit-perweight, after the post-training stages (details of the quantization scheme will be discussed later). The quantized model often shows a moderate level of quality loss. Therefore, instead of directly passing the quantized model to application teams for feature development, we attach a set of parameter-efficient [[LoRa Adapter|LoRa Adapter]]s for quality recovery. We make sure that these LoRA adapters training recipes are consistent with pre-training and post-training processes. Then, products will fine-tune their own feature-specific LoRA adapters by initializing the adapter weights from the accuracy-recovery adapters, while keeping the quantized base model frozen.” (Gunter et al., 2024, p. 16)

So the recipe is:
- Pre-training/Post-training
- Compression? and Quantization (leads to accuracy loss)
- LoRa fine-tuning to recover accuracy, call it LoRa Recovery, I'll assume this 
- For a specific task, initialize LoRa adapter to the LoRa Recovery
Some details:
- Rank 16 LoRa
- Does each LoRa adapter also share the same precision as the underlying weight block/matrix? I suppose so

“Specifically, our AFM-on-device model running on Apple Neural Engine (ANE) uses [[Bit Palettization|Bit Palettization]]: for projection weights, every 16 columns/rows share the same quantization constants (i.e., lookup tables) and are quantized using K-means with 16 unique values (4-bit).” (Gunter et al., 2024, p. 17)
